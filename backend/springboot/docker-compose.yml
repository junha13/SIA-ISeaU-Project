version: '3.8'

services:
  # 1. ìŠ¤í”„ë§ ë¶€íŠ¸ ì»¨í…Œì´ë„ˆ ì„¤ì •
  iseau:
    image: iseau-image:latest # ğŸš¨ ë³¸ì¸ì˜ ìŠ¤í”„ë§ ë¶€íŠ¸ ì´ë¯¸ì§€ ì´ë¦„ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”
    container_name: iseau      # Nginx ì„¤ì • íŒŒì¼ì—ì„œ ì‚¬ìš©í•œ ì´ë¦„
    ports:
      - "8080"                      # ì™¸ë¶€ì— ë…¸ì¶œí•˜ì§€ ì•Šê³  ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ë§Œ 8080 í¬íŠ¸ ì˜¤í”ˆ
    networks:
      - my_network                  # ê³µí†µ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°

  # 2. Nginx ì»¨í…Œì´ë„ˆ ì„¤ì •
  nginx:
    image: nginx:latest
    container_name: nginx-proxy
    volumes:
      # ì„¤ì • íŒŒì¼ ë§ˆìš´íŠ¸ (Step 2ì—ì„œ ë§Œë“  default.conf)
      - ./default.conf:/etc/nginx/conf.d/default.conf:ro
      # ğŸš¨ SSL ì¸ì¦ì„œ íŒŒì¼ ë§ˆìš´íŠ¸ (ì¸ì¦ì„œ ê²½ë¡œë¥¼ ì‹¤ì œ íŒŒì¼ ìœ„ì¹˜ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤)
      # - ./certs:/etc/nginx/certs:ro
    ports:
      - "80:80"                     # ë¡œì»¬ 80 í¬íŠ¸ë¥¼ Nginx 80ì— ì—°ê²° (HTTP)
      - "443:443"                   # ë¡œì»¬ 443 í¬íŠ¸ë¥¼ Nginx 443ì— ì—°ê²° (HTTPS)
    networks:
      - my_network
    depends_on:
      - iseau                  # spring-appì´ ë¨¼ì € ì‹œì‘ë˜ë„ë¡ ì˜ì¡´ì„± ì„¤ì •

# 3. ë„¤íŠ¸ì›Œí¬ ì •ì˜
networks:
  my_network:
    driver: bridge