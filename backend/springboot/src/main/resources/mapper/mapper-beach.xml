<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="lx.iseau.feature.beach.BeachDAO">

    <select id="findBeacheList" parameterType="BeachListRequest" resultType="BeachVO">
        SELECT
            beach_number,
            beach_name,
            beach_image,
            beach_information,
            rating,
            approved_by_ministry,
            address,    
            ST_Y(LOCATION::geometry) AS latitude,         
            ST_X(LOCATION::geometry) AS longitude,
            mobile,
            open_date,
            close_date
        FROM
            tb_beach
        WHERE
            1=1
       <!-- 
        <if test="region != null and region != ''">
            AND address LIKE CONCAT(#{region}, '%')
        </if>
        - -->
        <choose>
            <when test="sort == 'rating_desc'">
                ORDER BY rating DESC, beach_name ASC
            </when>
            <when test="sort == 'name_asc'">
                ORDER BY beach_name ASC
            </when>
            <otherwise>
                ORDER BY beach_number ASC
            </otherwise>
        </choose>
    </select>
    

	<select id="getBeachDetailInfo" parameterType="int" resultType="ResponseBeachDTO">
		select *
		from tb_beach
		where beach_number = #{beachNumber}
	</select>
	
	<select id="getBeachDetailDanger" parameterType="int" resultType="ResponseBeachDangerDTO">
		select temperature, ST_Y(observed_location::geometry) AS lat, ST_X(observed_location::geometry) AS lon
		from tb_weather_info
		where observed_location = (select location
									from tb_beach
									where beach_number = #{beachNumber})
	</select>

</mapper>
