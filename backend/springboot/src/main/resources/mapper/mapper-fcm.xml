<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lx.iseau.feature.fcm.FcmDAO">

    <insert id="upsertToken">
        INSERT INTO fcm_token (user_id, fcm_token, updated_at)
        VALUES (#{userId}, #{token}, now())
            ON CONFLICT (user_id) DO UPDATE
                                         SET   
                                             fcm_token = #{token},
                                         updated_at = now();
    </insert>

    <select id="getTokenByUserId" resultType="string">
        SELECT fcm_token
        FROM fcm_token
        WHERE user_id = #{userId}
    </select>
</mapper>