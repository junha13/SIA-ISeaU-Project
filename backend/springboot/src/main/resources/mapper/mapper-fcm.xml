<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="lx.iseau.feature.fcm.FcmDAO">

    <!-- 
        ðŸš¨ [DDL ê¸°ë°˜ ì™„ë²½ ìˆ˜ì •]
        1. í…Œì´ë¸”ëª…: tb_fcm_token
        2. ì»¬ëŸ¼ëª…: login_id (user_id ì•„ë‹˜)
        3. ì¶©ëŒ ê¸°ì¤€: login_id (UNIQUE ì œì•½ì¡°ê±´)
    -->
    <insert id="upsertToken">
        INSERT INTO tb_fcm_token (login_id, fcm_token, updated_at)
        VALUES (#{userId}, #{token}, NOW())
        ON CONFLICT (login_id) 
        DO UPDATE SET
            fcm_token = EXCLUDED.fcm_token,
            updated_at = NOW();
    </insert>

    <!-- ì¡°íšŒ ì¿¼ë¦¬ë„ login_id ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì • -->
    <select id="getTokenByUserId" resultType="string">
        SELECT fcm_token
        FROM tb_fcm_token
        WHERE login_id = #{userId}
    </select>

</mapper>