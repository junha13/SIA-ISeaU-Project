<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lx.iseau.feature.fcm.FcmDAO">

    <select id="getUserNumberByUserId" resultType="int">
        SELECT user_number
        FROM tb_user
        WHERE id = #{userId}
    </select>

    <insert id="upsertToken">
        INSERT INTO tb_fcm_token (user_number, fcm_token, updated_at)
        VALUES (#{userNumber}, #{token}, now())
            ON CONFLICT (user_number) DO UPDATE
                                             SET
                                                 fcm_token = #{token},
                                             updated_at = now();
    </insert>

    <select id="getTokenByUserNumber" resultType="string">
        SELECT fcm_token
        FROM tb_fcm_token
        WHERE user_number = #{userNumber}
    </select>
</mapper>