<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="lx.iseau.feature.fcm.FcmDAO">

    <insert id="upsertToken">
        INSERT INTO tb_fcm_token (login_id, fcm_token, updated_at)
        VALUES (#{userNumber}, #{token}, NOW())
        ON CONFLICT (login_id)
        DO UPDATE SET
            fcm_token = EXCLUDED.fcm_token, updated_at = NOW();
        INSERT INTO tb_fcm_token (
            login_id, fcm_token, updated_at)
        VALUES (#{userNumber}, #{token}, now())
            ON CONFLICT (login_id) DO UPDATE
                                          SET fcm_token = #{token},
                                          updated_at = now();
    </insert>

    <select id="getTokenByUserNumber" resultType="string">
        SELECT fcm_token
        FROM tb_fcm_token
        WHERE login_id = #{userId}
    </select>
</mapper>